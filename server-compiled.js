(()=>{"use strict";var e={440:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(167),o=a.n(n),l=a(689),i=a.n(l);const s=function(e){const[t,a]=(0,l.useState)(!1),[n,s]=(0,l.useState)(""),[r,c]=(0,l.useState)(),[m,d]=(0,l.useState)(""),[p,u]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[y,h]=(0,l.useState)(""),[f,v]=(0,l.useState)("");return i().createElement("div",{className:"card"},i().createElement("div",{className:"our-card-top"},t&&i().createElement("div",{className:"our-custom-input"},i().createElement("div",{className:"our-custom-input-interior"},i().createElement("input",{onChange:e=>c(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),i().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`${e.ip} named ${e.name} bay number ${e.bay} `})),i().createElement("div",{className:"card-body"},!t&&i().createElement(i().Fragment,null,i().createElement("h4",null,e.name),i().createElement("p",{className:"text-muted small"},"ip: ",e.ip),i().createElement("p",{className:"text-muted small"},"Bay: ",e.bay),i().createElement("p",{className:"text-muted small"},"gauge: ",e.gauge),i().createElement("p",{className:"text-muted small"},"Stock: ",e.stock),!e.readOnly&&i().createElement(i().Fragment,null,i().createElement("button",{onClick:()=>{a(!0),s(e.name),d(e.ip),u(e.bay),b(e.gauge),h(e.maxHeight),c("")},className:"btn btn-sm btn-primary"},"Edit")," ",i().createElement("button",{onClick:async()=>{o().delete(`/animal/${e.id}`),e.setAnimals((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&i().createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,name:n,ip:m,bay:p,gauge:g,maxHeight:y,stock:f}:t}))));const l=new FormData;r&&l.append("photo",r),l.append("_id",e.id),l.append("name",n),l.append("ip",m),l.append("bay",p),l.append("gauge",g),l.append("maxHeight",y),l.append("stock",f);const i=await o().post("/update-animal",l,{headers:{"Content-Type":"multipart/form-data"}});i.data&&e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,photo:i.data}:t}))))}},i().createElement("div",{className:"mb-1"},i().createElement("input",{autoFocus:!0,onChange:e=>s(e.target.value),type:"text",className:"form-control form-control-sm",value:n,placeholder:"name"})),i().createElement("div",{className:"mb-2"},i().createElement("input",{onChange:e=>d(e.target.value),type:"text",className:"form-control form-control-sm",value:m,placeholder:"ip adress"})),i().createElement("div",{className:"mb-2"},i().createElement("input",{onChange:e=>u(e.target.value),type:"text",className:"form-control form-control-sm",value:p,placeholder:"bay number"})),i().createElement("div",{className:"mb-2"},i().createElement("input",{onChange:e=>b(e.target.value),type:"text",className:"form-control form-control-sm",value:g,placeholder:"material gauge"})),i().createElement("div",{className:"mb-2"},i().createElement("input",{onChange:e=>h(e.target.value),type:"text",className:"form-control form-control-sm",value:y,placeholder:"maximum height"})),i().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",i().createElement("button",{onClick:()=>a(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},167:e=>{e.exports=require("axios")},48:e=>{e.exports=require("cheerio")},857:e=>{e.exports=require("cron")},860:e=>{e.exports=require("express")},470:e=>{e.exports=require("fs-extra")},13:e=>{e.exports=require("mongodb")},738:e=>{e.exports=require("multer")},689:e=>{e.exports=require("react")},684:e=>{e.exports=require("react-dom/server")},109:e=>{e.exports=require("sanitize-html")},441:e=>{e.exports=require("sharp")},17:e=>{e.exports=require("path")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,a),l.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=a(167),t=a(48),n=async function(a){const{data:n}=await e.get(a),o=t.load(n)("h1").html();console.log(o);const l=parseInt(o);return console.log(l),l},{MongoClient:o,ObjectId:l}=a(13),i=a(860),s=i(),r=a(109),c=a(857),m=a(738)(),d=a(470),p=a(441);let u;const g=a(17),b=a(689),y=a(684),h=a(440).Z;function f(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.ip&&(e.body.ip=""),"string"!=typeof e.body._id&&(e.body._id=""),"string"!=typeof e.body.bay&&(e.body.bay=""),"string"!=typeof e.body.gauge&&(e.body.gauge=""),"string"!=typeof e.body.maxHeight&&(e.body.maxHeight=""),e.cleanData={name:r(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),ip:r(e.body.ip.trim(),{allowedTags:[],allowedAttributes:{}}),bay:r(e.body.bay.trim(),{allowedTags:[],allowedAttributes:{}}),maxHeight:r(e.body.maxHeight.trim(),{allowedTags:[],allowedAttributes:{}}),gauge:r(e.body.gauge.trim(),{allowedTags:[],allowedAttributes:{}})},a()}d.ensureDirSync(g.join("public","uploaded-photos")),s.set("view engine","ejs"),s.set("views","./views"),s.use(i.static("public")),s.use(i.json()),s.use(i.urlencoded({extended:!1})),new c.CronJob("*/10 * * * * *",(async()=>{console.log("cron job");let e=await u.collection("animals").find().toArray(),t=e.map((e=>e.ip));console.log(t);let a=e.map((e=>e.maxHeight)),o=e.map((e=>e.gauge));for(let i=0;i<t.length;i++){console.log(t[i]);let s=await n(t[i]),r=a[i]-s;console.log(a[i]),console.log(o[i]);let c=r/o[i];console.log(c),await u.collection("animals").updateOne({_id:l(e[i]._id)},{$set:{stock:c}})}let i=e.map((e=>e.stock));console.log(i)})).start(),s.get("/",(async(e,t)=>{const a=await u.collection("animals").find().toArray(),n=y.renderToString(b.createElement("div",{className:"container"},b.createElement("div",{className:"animal-grid mb-3"},a.map((e=>b.createElement(h,{key:e._id,name:e.name,ip:e.ip,photo:e.photo,id:e._id,bay:e.bay,maxHeight:e.maxHeight,gauge:e.gauge,stock:e.stock,readOnly:!0})))),b.createElement("p",null,b.createElement("a",{href:"/admin"},"manage items"))));t.render("home",{generatedHTML:n})})),s.use((function(e,t,a){t.set("WWW-Authenticate",'Basic realm="Our MERN App"'),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?a():(console.log(e.headers.authorization),t.status(401).send("Authentication required"))})),s.get("/admin",((e,t)=>{t.render("admin")})),s.get("/inventory",((e,t)=>{t.render("inventory")})),s.get("/api/inventory",(async(e,t)=>{await u.collection("inventory").find().toArray(),t.json("inv")})),s.get("/api/animals",(async(e,t)=>{const a=await u.collection("animals").find().toArray();t.json(a)})),s.post("/create-animal",m.single("photo"),f,(async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await p(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(g.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const a=await u.collection("animals").insertOne(e.cleanData),n=await u.collection("animals").findOne({_id:new l(a.insertedId)});t.send(n)})),s.delete("/animal/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await u.collection("animals").findOne({_id:new l(e.params.id)});a.photo&&d.remove(g.join("public","uploaded-photos",a.photo));const n=e.params.id;u.collection("animals").deleteOne({_id:new l(n)}),t.send("success")})),s.post("/update-animal",m.single("photo"),f,(async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await p(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(g.join("public","uploaded-photos",t)),e.cleanData.photo=t;const a=await u.collection("animals").findOneAndUpdate({_id:new l(e.body._id)},{$set:e.cleanData});a.value.photo&&d.remove(g.join("public","uploaded-photos",a.value.photo))}else u.collection("animals").findOneAndUpdate({_id:new l(e.body._id)},{$set:e.cleanData}),t.send(!1)})),async function(){try{const e=new o("mongodb://root:root@172.27.64.1:27017/AmazingMernApp?&authSource=admin");await e.connect(),console.log("Connected to database"),u=e.db()}catch(e){console.log(e)}}(),s.listen(3e3,(()=>console.log("Example app listening on port 3000!")))})()})();